<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
	<link rel="shortcut icon" href="#"/>
	<title>Document</title>

	<style>
	@import url(https://fonts.googleapis.com/earlyaccess/notosanstc.css);
	*{font-family:'Noto Sans TC','å¾®è»Ÿæ­£é»‘é«”';}
	*,*::before,*::after{margin:0px; padding:0px; -webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box;}
	.clearfix:after{content:''; display:block; height:0; clear:both; visibility:hidden;}
	hr{margin:20px 0px;}
	pre{border:2px solid deeppink; padding:5px; margin:2px; font-size:12px; background:rgba(255,255,255,0.7); clear:both; font-size:12px; font-family:'Source Code Pro'; tab-size:4; -moz-tab-size:4; white-space:pre-wrap;}
	pre strong{color:#CC0000;}
	pre em{font-style:normal; font-weight:bold; color:#006600;}
	button{ padding:5px 10px; }
	.gallery{ width:100%; max-width:1000px; padding:10px;  margin:0 auto;  border:2px solid #333;
	display:flex; flex-wrap:wrap; justify-content:space-between; align-content:flex-start;}

	.gallery .col_1{ width:300px; padding:10px;  margin-right:20px;   background:#ccc; }

	.gallery .col_2{ width:300px; padding:10px; background:#777; flex:1; }

	#myCanvas{box-shadow:0px 0px 5px 0px rgba(0,0,0,0.5);  }

	</style>
</head>
<body>

	<h1>è¼¸å‡º æˆªåœ– å»é‚Š</h1>
	<p>éœ€è¦ localhost</p>

	<!--gallery é–‹å§‹-->
		<div class="gallery">
			<!--col_1 é–‹å§‹-->
			<div class="col_1">

				
				<button class="btn_jpg">æˆªåœ–å»é‚Š</button>
				
			</div>
			<!--col_1 çµæŸ-->
	
			<!--col_2 é–‹å§‹-->
			<div class="col_2">
				<canvas id="myCanvas"></canvas>
			</div>
			<!--col_2 çµæŸ-->
		</div>
		<!--gallery çµæŸ-->

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/451/fabric.min.js"></script>
	
	<script>
	$(function(){
		let myFabric = new fabric.Canvas("myCanvas", {
			width:414, //å¯¬é«˜
			height:736, //å¯¬é«˜
			backgroundColor: "yellowgreen", // èƒŒæ™¯è‰²
		});

		const elPic = document.createElement('img')
		elPic.src = "./images/dog.jpg"
		elPic.onload = () => {
			const myImg = new fabric.Image(elPic, {
				width: 200,
				height: 200,
				left:10,
				top:100,
			});
			myFabric.add(myImg);
		}

		let myTxt = new fabric.Textbox("ğŸ•é€™æ˜¯ä¸€éš»ç‹—\næ±ªæ±ªå«!!", {
			left:50,
			top:50,
			width:200,
			height:100,
			fontSize:50, //å­—å°ºå¯¸
			fontFamily:"Noto Sans TC", //å­—é«” css
			textAlign:"center", //ç½®ä¸­
			fontWeight:800, //å­—ç²—
			fill: "gold", //å­—è‰²
			shadow:"5px 5px 10px #000 ", //é™°å½±
		});
			
		myFabric.add(myTxt);

		

		//é¸å– z-index ç§»åˆ°ä¸Šå±¤
		myFabric.on("selection:created", function(e) {
			console.log(e);
			e.target.bringToFront();
		});

		

		function fnOutput2() {

			//å…ƒä»¶çµ„æˆç¾¤çµ„
			var tmpGroup = new fabric.ActiveSelection(myFabric.getObjects(), {
				canvas: myFabric,
			});

			//ç¾¤çµ„è½‰æˆ64ä½å…ƒ
			const dataURL = tmpGroup.toDataURL({
				format: "image/png", //å‰¯æª”å
				multiplier: 3, //è¼¸å‡ºç¸®æ”¾å€ç‡ 0.5 è¼¸å‡ºåŸæœ¬ä¸€åŠ
				quality: 0.9 //åœ–ç‰‡çš„è³ªé‡ï¼Œç¯„åœç‚º 0~1
			});

			//é è¦½
			window.open(dataURL, '_blank', 'scrollbars=yes'); 

			//ç¸®åœ–ä¸‹è¼‰
			const elA = document.createElement('a');
			elA.href = dataURL;
			elA.download = `output_${new Date().getTime()}.png`;
			elA.innerHTML = `<img style="width:100px; height:auto; border:1px solid #333;" src="${dataURL}">`;
			document.body.prepend(elA);

			//è‡ªå‹•ä¸‹è¼‰
			//elA.click();
			//document.body.removeChild(elA);
			
		}

		$(".btn_jpg").click(function(){
			fnOutput2();
		});



	});
	</script>


	



	
</body>
</html>